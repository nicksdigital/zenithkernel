<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZenithKernel Test App</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      padding: 20px;
      max-width: 1000px;
      margin: 0 auto;
      color: #333;
      background: #f5f5f5;
    }
    header {
      margin-bottom: 30px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 20px;
    }
    h1 {
      color: #2d3748;
    }
    .nav {
      display: flex;
      gap: 20px;
      margin: 20px 0;
    }
    .nav-link {
      padding: 8px 16px;
      background: #e2e8f0;
      border-radius: 4px;
      color: #4a5568;
      text-decoration: none;
      transition: background 0.2s;
    }
    .nav-link:hover {
      background: #cbd5e0;
    }
    section {
      margin: 30px 0;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .island-container {
      border: 1px dashed #cbd5e0;
      margin: 20px 0;
      padding: 20px;
      border-radius: 4px;
    }
    .debug {
      margin-top: 30px;
      padding: 15px;
      background: #1a202c;
      color: #e2e8f0;
      border-radius: 4px;
      overflow: auto;
    }
    .debug pre {
      margin: 0;
    }
    footer {
      margin-top: 40px;
      text-align: center;
      font-size: 14px;
      color: #718096;
    }
  </style>
</head>
<body>
  <header>
    <h1>ZenithKernel Test App</h1>
    <p>A demonstration of ZenithKernel's core features including routing, ECS, and island hydration.</p>
    
    <div class="nav">
      <a href="#/" class="nav-link">Home</a>
      <a href="#/counter" class="nav-link">Counter Demo</a>
      <a href="#/users/admin" class="nav-link">User Profile (Admin)</a>
      <a href="#/users/guest" class="nav-link">User Profile (Guest)</a>
    </div>
  </header>
  
  <main>
    <section id="current-route">
      <h2>Current Route</h2>
      <div id="route-content">Loading...</div>
    </section>
    
    <section>
      <h2>Counter Island Demo</h2>
      <div class="island-container">
        <!-- This div will be populated by the CounterIsland component -->
        <div id="counter-island-container" data-zk-island="CounterIsland" data-initial-count="5"></div>
      </div>
    </section>
    
    <section>
      <h2>System Status</h2>
      <div id="system-status">Initializing...</div>
    </section>
    
    <section>
      <h2>Debug Console</h2>
      <div class="debug">
        <pre id="debug-output">// Debug output will appear here</pre>
      </div>
    </section>
  </main>
  
  <footer>
    <p>ZenithKernel Test App &copy; 2025</p>
  </footer>

  <!-- Script to load our test app -->
  <script type="module">
    import { bootstrapTestApp } from './src/index.js';
    
    // Console output redirector
    const debugOutput = document.getElementById('debug-output');
    const originalConsole = { ...console };
    
    // Override console methods to capture output
    ['log', 'info', 'warn', 'error'].forEach(method => {
      console[method] = (...args) => {
        // Call original method
        originalConsole[method](...args);
        
        // Add to debug output
        const line = args.map(arg => 
          typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
        ).join(' ');
        
        debugOutput.textContent += `\n[${method}] ${line}`;
        
        // Scroll to bottom
        debugOutput.scrollTop = debugOutput.scrollHeight;
      };
    });
    
    // Wait for DOM to be ready before bootstrapping
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        console.log('üöÄ Starting ZenithKernel Test App...');
        const { kernel, router } = await bootstrapTestApp();
        
        // Update system status
        const systemStatus = document.getElementById('system-status');
        systemStatus.innerHTML = `
          <div>Kernel Status: <strong>Running</strong></div>
          <div>Router Status: <strong>Active</strong></div>
          <div>ECS Entities: <strong>${kernel.getECS().getEntityCount()}</strong></div>
          <div>Registered Systems: <strong>${Object.keys(kernel.systems).length}</strong></div>
        `;
        
        // Update route content when hash changes
        const updateRouteContent = () => {
          const path = window.location.hash.slice(1) || '/';
          router.navigate(path);
          
          const routeContent = document.getElementById('route-content');
          routeContent.innerHTML = `<div>Current path: <strong>${path}</strong></div>`;
        };
        
        // Listen for hash changes
        window.addEventListener('hashchange', updateRouteContent);
        
        // Initial route
        updateRouteContent();
        
      } catch (error) {
        console.error('‚ùå Failed to initialize test app:', error);
        document.getElementById('system-status').innerHTML = `
          <div style="color: red;">Error: ${error.message}</div>
        `;
      }
    });
  </script>
</body>
</html>
